create database QLCOSMESTIC
use QLCOSMESTIC

CREATE TABLE ROLE(
    NAME_ROLE NVARCHAR(100) NOT NULL PRIMARY KEY
	)

CREATE TABLE ACCOUNT(
	USERNAME VARCHAR(20) PRIMARY KEY NOT NULL,
    PASSWORD VARCHAR(20) NOT NULL,
	)

CREATE TABLE CATEGORY(
	ID_CATEGORY INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	NAME_CATEGORY NVARCHAR(100) NOT NULL,
	)

CREATE TABLE PRODUCT(
	ID_PRODUCT VARCHAR(50) NOT NULL,
	NAME_PRODUCT NVARCHAR(100) NOT NULL,
    SPECIFICATION NVARCHAR(20),
	AMOUNT INT NOT NULL,
    PRICE INT NOT NULL,
    ID_CATEGORY INT NOT NULL,
    PRIMARY KEY (ID_PRODUCT)
	)

CREATE TABLE WORKSHIFT(
	ID_SHIFT VARCHAR(15) PRIMARY KEY NOT NULL CHECK (ID_SHIFT like '[C][1-3]' or ID_SHIFT like 'FULLTIME'),
	FROM_TIME TIME NOT NULL,
	TO_TIME TIME NOT NULL
	)

CREATE TABLE EMPLOYEE(
	ID_EMPLOYEE INT NOT NULL IDENTITY(1,1),
    USERNAME VARCHAR(20) NOT NULL,
    NAME_EMPLOYEE NVARCHAR(100) NOT NULL,
    GENDER NVARCHAR(3) NOT NULL CHECK (GENDER = 'Nam' or  GENDER = N'Nữ'),
	BIRTH DATE NOT NULL, -- yyyy/mm/dd
    ID_NUMBER NVARCHAR(12) UNIQUE NOT NULL CHECK (ID_NUMBER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
											or ID_NUMBER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
    EMPLOYEE_ADDRESS NVARCHAR(100) NOT NULL,
    PHONE_NUMBER CHAR(12) NOT NULL CHECK (PHONE_NUMBER like '+84[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' or 
										PHONE_NUMBER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
    EMAIL NVARCHAR(50),
    BEGIN_DAY DATE NOT NULL,
    NAME_ROLE NVARCHAR(100) NOT NULL,
    ID_SHIFT VARCHAR(15) NOT NULL,
    SALARY FLOAT NOT NULL,
	PRIMARY KEY(ID_EMPLOYEE)
	)

CREATE TABLE CUSTOMER(
	PHONE_NUMBER_CUSTOMER VARCHAR(12) PRIMARY KEY NOT NULL CHECK (PHONE_NUMBER_CUSTOMER like '+84[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' or 
														PHONE_NUMBER_CUSTOMER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
	CUSTOMERNAME NVARCHAR(100) NOT NULL,
    CUSTOMER_ADDRESS NVARCHAR(100)
	)

CREATE TABLE BILL(
	ID_BILL INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	TOTAL_PRICE FLOAT NOT NULL,
    INVOICE_DAY DATE NOT NULL,
    ID_EMPLOYEE INT NOT NULL,
    PHONE_NUMBER_CUSTOMER VARCHAR(12) CHECK (PHONE_NUMBER_CUSTOMER like '+84[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' or 
														PHONE_NUMBER_CUSTOMER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
	ID_EVENT INT NOT NULL
	)  

CREATE TABLE DETAILBILL(
	ID_BILL INT NOT NULL,
    ID_PRODUCT VARCHAR(50) NOT NULL,
    AMOUNT INT NOT NULL,
    PRICE INT NOT NULL,    
    PRIMARY KEY (ID_BILL,ID_PRODUCT)
	)

--PHI?U NH?P
CREATE TABLE RECEIVEDNOTE(
	ID_RECEIVE INT NOT NULL IDENTITY(1,1),
    ID_EMPLOYEE INT NOT NULL, -- nhan vien KHO
	ID_PRODUCT VARCHAR(50) NOT NULL,
    AMOUNT INT NOT NULL,
    TOTAL_PRICE_RECEIVE FLOAT NOT NULL,
    DATE_RECIVE DATETIME NOT NULL,
	NAME_PROVIDER NVARCHAR(100) NOT NULL,
    PROVIDER_ADDRESS NVARCHAR(100) NOT NULL,
    PHONE_NUMBER_PROVIDER CHAR(12) NOT NULL CHECK (PHONE_NUMBER_PROVIDER like '+84[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' or 
													PHONE_NUMBER_PROVIDER like '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
    PRIMARY KEY (ID_RECEIVE)
	)


CREATE TABLE DISCOUNT_EVENT(
	ID_EVENT INT PRIMARY KEY NOT NULL IDENTITY(1,1),
	NAME_EVENT NVARCHAR(100) NOT NULL,
	DISCOUNT INT NOT NULL DEFAULT 0
)

ALTER TABLE PRODUCT ADD CONSTRAINT PK_PRODUCT_CATEGORY FOREIGN KEY (ID_CATEGORY) REFERENCES CATEGORY(ID_CATEGORY) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE EMPLOYEE ADD CONSTRAINT PK_EMPLOYEE_WORKSHIFT FOREIGN KEY (ID_SHIFT) REFERENCES WORKSHIFT(ID_SHIFT)ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE EMPLOYEE ADD CONSTRAINT PK_EMPLOYEE_ACCOUNT FOREIGN KEY (USERNAME) REFERENCES ACCOUNT(USERNAME) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE EMPLOYEE ADD CONSTRAINT PK_EMPLOYEE_ROLE FOREIGN KEY (NAME_ROLE) REFERENCES ROLE(NAME_ROLE)ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE BILL ADD CONSTRAINT PK_BILL_EMPLOYEE FOREIGN KEY (ID_EMPLOYEE) REFERENCES EMPLOYEE(ID_EMPLOYEE) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE BILL ADD CONSTRAINT PK_BILL_CUSTOMER FOREIGN KEY (PHONE_NUMBER_CUSTOMER) REFERENCES CUSTOMER(PHONE_NUMBER_CUSTOMER) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE DETAILBILL ADD CONSTRAINT PK_DETAILBILL_BILL FOREIGN KEY (ID_BILL) REFERENCES BILL(ID_BILL) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE RECEIVEDNOTE ADD CONSTRAINT PK_RECEIVEDNOTE_EMPLOYEE FOREIGN KEY (ID_EMPLOYEE) REFERENCES EMPLOYEE(ID_EMPLOYEE) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE RECEIVEDNOTE ADD CONSTRAINT PK_RECEIVEDNOTE_PRODUCT FOREIGN KEY (ID_PRODUCT) REFERENCES PRODUCT(ID_PRODUCT) ON DELETE CASCADE ON UPDATE CASCADE
ALTER TABLE BILL ADD CONSTRAINT PK_BILL_DISCOUNT_EVENT FOREIGN KEY (ID_EVENT) REFERENCES DISCOUNT_EVENT(ID_EVENT) ON DELETE CASCADE ON UPDATE CASCADE


INSERT INTO DISCOUNT_EVENT(NAME_EVENT,DISCOUNT) VALUES 
	(N'Không có',0),
	(N'20/11',10),
	(N'Noel',10),
	(N'Khách hàng mới',5);

INSERT INTO ROLE(NAME_ROLE) VALUES 
	(N'Nhân viên kho'),
	(N'Quản lý'),
	(N'Nhân viên bán hàng');
    
INSERT INTO ACCOUNT(USERNAME,PASSWORD) VALUES
	('Admin','123456'),
	('NvHa','123456'),
	('NvThuy','123456'),
	('NvLinh','123456'),
	('NvKhai','123456');

INSERT INTO CATEGORY(NAME_CATEGORY) VALUES 
    (N'Trang điểm'),
    (N'Chăm Sóc Tóc'),
    (N'Chăm Sóc Da Mặt'),
	(N'BodyCare'),
	(N'Phụ kiện');

INSERT INTO PRODUCT(ID_PRODUCT,NAME_PRODUCT,SPECIFICATION,AMOUNT,PRICE,ID_CATEGORY) VALUES 
	('3CE-VLT-01','Son 3CE Velvet Lip Tint','Private',300,320000,1),
	('3CE-VLT-02','Son 3CE Velvet Lip Tint','Taupe',200,320000,1),
	('BR-AFV-A06','Son Black Rouge Air Fit Velvet','A06',200,150000,1),
	('KDD-VASELINE',N'Kem Dưỡng Trắng Da Veseline','320ml',200,200000,4),
	('MISSENSERUM-LIGHT',N'Tinh Chất Dưỡng Tóc Missen Scence Perfect Hair','Light',180,180000,2),
	('SRM-INNISFREE-GTFC',N'Sữa Rửa Mặt Innisfree Green Tea Foan Cleanser','150ml',100,140000,3),
	('DGD-TRESEMME-BLACK',N'Dầu Gội Đầu Tresemme Smooth And Silky','320ml',500,200000,2),
	('GCT-3CE-L',N'Gương Cầm Tay 3CE',N'Lớn',100,195000,5),
	('GCT-3CE-N',N'Gương Cầm Tay 3CE',N'Nhỏ',80,130000,5),
	('CTD-BIOAQUA-TIM',N'Bộ Cọ Trang Điểm Bioaqua',N'Tím',600,50000,5),
	('TTBCD-ORGANIC',N'Tẩy Tế Bào Chết Toàn Thân Organic Shop Organic Coffee & Sugar Body Scrub','Coffee, 250ml',250,110000,4),
	('KCN-INNISFREE-TRIPLE',N'Kem Chống Nắng Innisfree Intensive Triple Care Sunscreen SPF50+ PA++++','50ml',800,165000,3);
	
    
INSERT INTO WORKSHIFT VALUES 
	('C1','07:00','12:00'),
	('C2','12:00','17:00'),
	('C3','17:00','22:00'),
    ('FULLTIME','07:00','22:00');

INSERT INTO EMPLOYEE(USERNAME,NAME_EMPLOYEE,GENDER,BIRTH,ID_NUMBER,EMPLOYEE_ADDRESS,PHONE_NUMBER,EMAIL,BEGIN_DAY,NAME_ROLE,ID_SHIFT,SALARY) VALUES
	('Admin',N'Đoàn Ngọc Hải ',N'Nữ','1997/04/11','879578213','TPHCM','+84784959523','dnh@gmail.com','2015/03/10',N'Quản lý','FULLTIME',10000000),
	('NvHa',N'Đoàn Thủy Hà',N'Nữ','1997/04/10','454325675','TPHCM','+84346568766','dth@gmail.com','2018/03/10',N'Nhân viên bán hàng','C2',3000000),
	('NvThuy',N'Nguyễn Hoàng Ngọc Thủy',N'Nữ','1998/09/08','483579813','TPHCM','+84489235789','nhhthuy@gmail.com','2018/08/16',N'Nhân viên bán hàng','C1',3000000),
	('NvLinh',N'Huỳnh Thụy Trúc Linh',N'Nữ','1998/03/08','879643258','TPHCM','+84785496332','Linh83@gmail.com','2017/02/10',N'Nhân viên bán hàng','FULLTIME',9000000),
	('NvKhai',N'Nguyễn Hoàng Khải',N'Nam','1997/06/18','236987561','TPHCM','+84633985612','nhkhai168@gmail.com','2016/08/09',N'Nhân viên kho','FULLTIME',9000000)
	

INSERT INTO CUSTOMER(PHONE_NUMBER_CUSTOMER,CUSTOMERNAME,CUSTOMER_ADDRESS) VALUES
	('+84569898870',N'Nguyễn Phạm Hồng Hải',N'315/3 Đường Tôn Thất Thuyết, Phường 1, Quận 4'),
	('+84798585679',N'Nguyễn Ngọc Quỳnh Như',N'31 Hàn Thuyên, Phường Bến Nghé, Quận 1'),
	('+84565621477',N'Đỗ Thụy Minh Phương',N'50 Đường số 8A, Khu đô thị An Phú An Khánh, Phường An Phú, Quận 2');
	
	 
INSERT INTO BILL(TOTAL_PRICE,INVOICE_DAY,ID_EMPLOYEE,PHONE_NUMBER_CUSTOMER,ID_EVENT) VALUES
	(640000,'2019/10/17',2,'+84569898870',1),
    (340000,'2019/10/17',2,'+84798585679',1),
    (670000,'2019/10/17',1,'+84565621477',3),
    (150000,'2019/10/18',3,'+84569898870',3),
    (180000,'2019/10/18',1,'+84565621477',3);
	    
    
INSERT INTO DETAILBILL(ID_BILL,ID_PRODUCT,AMOUNT,PRICE) VALUES
	(1,'3CE-VLT-01',2,640000),
	(2,'KDD-VASELINE',1,200000),
	(2,'SRM-INNISFREE-GTFC',1,140000),
	(3,'CTD-BIOAQUA-TIM',1,50000),
	(3,'3CE-VLT-01',1,320000),
	(3,'BR-AFV-A06',2,300000),
	(4,'BR-AFV-A06',1,150000),
	(5,'MISSENSERUM-LIGHT',1,180000);    
   
INSERT INTO RECEIVEDNOTE(ID_EMPLOYEE,ID_PRODUCT,AMOUNT,TOTAL_PRICE_RECEIVE,DATE_RECIVE,NAME_PROVIDER,PROVIDER_ADDRESS,PHONE_NUMBER_PROVIDER) VALUES
    (4,'3CE-VLT-01',200,64000000,'2019/03/04 08:03:26',N'Công Ty TNHH ACE',N'Số 158/14 Trần Huy Liệu, Phường 15, Quận Phú Nhuận','+84873037368'),
    (3,'KCN-INNISFREE-TRIPLE',300,49500000,'2019/02/02 08:07:56',N'Công Ty TNHH Shopa',N'261 Hoàng Văn Thụ, Phường 02, Quận Bình Thạnh ','+84885883666'),
	(3,'KDD-VASELINE',50,10000000,'2019/11/05 09:10:00',N'Công Ty TNHH Mask Korea',N'279/27 Huỳnh Văn Bánh, Phườnng 11, Quậnn Phú Nhuậnn','+84981808083');

--DROP TABLE EMPLOYEE
select * from PRODUCT
select * from RECEIVEDNOTE
update PRODUCT set AMOUNT = AMOUNT+2 WHERE ID_PRODUCT LIKE '3CE-VLT-01'
DROP DATABASE QLCOSMESTIC
DELETE FROM BILL WHERE INVOICE_DAY LIKE '2019-12-01' 
select * from BILL
